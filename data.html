<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Courier New', monospace;
            background: #0a0a0a;
            color: #00ff00;
            padding: 20px;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        h1 {
            color: #00ff00;
            margin-bottom: 20px;
            font-size: 24px;
            border-bottom: 2px solid #00ff00;
            padding-bottom: 10px;
        }
        .section {
            background: #1a1a1a;
            margin-bottom: 15px;
            padding: 15px;
            border: 1px solid #00ff00;
            border-radius: 5px;
        }
        .section h2 {
            color: #00ff00;
            font-size: 18px;
            margin-bottom: 10px;
            text-transform: uppercase;
        }
        .item {
            padding: 5px 0;
            border-bottom: 1px solid #333;
        }
        .item:last-child {
            border-bottom: none;
        }
        .key {
            color: #ffaa00;
            display: inline-block;
            width: 200px;
            font-weight: bold;
        }
        .value {
            color: #00ff00;
            word-break: break-all;
        }
        .btn {
            background: #00ff00;
            color: #0a0a0a;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            margin: 5px;
            border-radius: 3px;
        }
        .btn:hover {
            background: #00cc00;
        }
        .map {
            width: 100%;
            height: 400px;
            border: 1px solid #00ff00;
            margin-top: 10px;
            background: #000;
        }
        .error {
            color: #ff0000;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>COLLECTED DATA</h1>
        <div>
            <button class="btn" onclick="copyAll()">COPY ALL</button>
            <button class="btn" onclick="downloadJSON()">DOWNLOAD JSON</button>
            <button class="btn" onclick="downloadCSV()">DOWNLOAD CSV</button>
        </div>
        <div id="content"></div>
    </div>

    <script>
        let allData = {};

        function init() {
            const params = new URLSearchParams(window.location.search);
            const encoded = params.get('d');
            
            if (!encoded) {
                document.getElementById('content').innerHTML = '<div class="section error">NO DATA</div>';
                return;
            }

            try {
                allData = JSON.parse(atob(encoded));
                displayData(allData);
            } catch (e) {
                document.getElementById('content').innerHTML = '<div class="section error">ERROR PARSING DATA</div>';
            }
        }

        function displayData(data) {
            let html = '';

            // IP Section
            if (data.ip) {
                html += '<div class="section"><h2>IP INFORMATION</h2>';
                html += `<div class="item"><span class="key">IP ADDRESS</span><span class="value">${data.ip}</span></div>`;
                
                if (data.ipDetails) {
                    const details = data.ipDetails;
                    html += `<div class="item"><span class="key">CITY</span><span class="value">${details.city || 'N/A'}</span></div>`;
                    html += `<div class="item"><span class="key">REGION</span><span class="value">${details.region || 'N/A'}</span></div>`;
                    html += `<div class="item"><span class="key">COUNTRY</span><span class="value">${details.country_name || 'N/A'}</span></div>`;
                    html += `<div class="item"><span class="key">POSTAL</span><span class="value">${details.postal || 'N/A'}</span></div>`;
                    html += `<div class="item"><span class="key">LAT/LON</span><span class="value">${details.latitude}, ${details.longitude}</span></div>`;
                    html += `<div class="item"><span class="key">TIMEZONE</span><span class="value">${details.timezone || 'N/A'}</span></div>`;
                    html += `<div class="item"><span class="key">ISP</span><span class="value">${details.org || 'N/A'}</span></div>`;
                }
                html += '</div>';
            }

            // Geolocation
            if (data.geo) {
                html += '<div class="section"><h2>GPS COORDINATES</h2>';
                if (data.geo.error) {
                    html += `<div class="item"><span class="key">STATUS</span><span class="value error">${data.geo.error}</span></div>`;
                } else {
                    html += `<div class="item"><span class="key">LATITUDE</span><span class="value">${data.geo.lat}</span></div>`;
                    html += `<div class="item"><span class="key">LONGITUDE</span><span class="value">${data.geo.lon}</span></div>`;
                    html += `<div class="item"><span class="key">ACCURACY</span><span class="value">${data.geo.acc} meters</span></div>`;
                    if (data.geo.alt) html += `<div class="item"><span class="key">ALTITUDE</span><span class="value">${data.geo.alt} m</span></div>`;
                    if (data.geo.heading) html += `<div class="item"><span class="key">HEADING</span><span class="value">${data.geo.heading}Â°</span></div>`;
                    if (data.geo.speed) html += `<div class="item"><span class="key">SPEED</span><span class="value">${data.geo.speed} m/s</span></div>`;
                    
                    html += `<div class="map" id="map"></div>`;
                    setTimeout(() => {
                        document.getElementById('map').innerHTML = `<iframe width="100%" height="100%" frameborder="0" src="https://www.openstreetmap.org/export/embed.html?bbox=${data.geo.lon-0.01},${data.geo.lat-0.01},${data.geo.lon+0.01},${data.geo.lat+0.01}&marker=${data.geo.lat},${data.geo.lon}"></iframe>`;
                    }, 100);
                }
                html += '</div>';
            }

            // Browser
            if (data.browser) {
                html += '<div class="section"><h2>BROWSER</h2>';
                for (const [key, value] of Object.entries(data.browser)) {
                    html += `<div class="item"><span class="key">${key.toUpperCase()}</span><span class="value">${value}</span></div>`;
                }
                html += '</div>';
            }

            // Screen
            if (data.screen) {
                html += '<div class="section"><h2>SCREEN</h2>';
                for (const [key, value] of Object.entries(data.screen)) {
                    html += `<div class="item"><span class="key">${key.toUpperCase()}</span><span class="value">${value}</span></div>`;
                }
                html += '</div>';
            }

            // Window
            if (data.window) {
                html += '<div class="section"><h2>WINDOW</h2>';
                for (const [key, value] of Object.entries(data.window)) {
                    html += `<div class="item"><span class="key">${key.toUpperCase()}</span><span class="value">${value}</span></div>`;
                }
                html += '</div>';
            }

            // Connection
            if (data.conn) {
                html += '<div class="section"><h2>CONNECTION</h2>';
                for (const [key, value] of Object.entries(data.conn)) {
                    html += `<div class="item"><span class="key">${key.toUpperCase()}</span><span class="value">${value}</span></div>`;
                }
                html += '</div>';
            }

            // Battery
            if (data.battery) {
                html += '<div class="section"><h2>BATTERY</h2>';
                for (const [key, value] of Object.entries(data.battery)) {
                    html += `<div class="item"><span class="key">${key.toUpperCase()}</span><span class="value">${value}</span></div>`;
                }
                html += '</div>';
            }

            // Timezone
            if (data.tz) {
                html += '<div class="section"><h2>TIMEZONE</h2>';
                for (const [key, value] of Object.entries(data.tz)) {
                    html += `<div class="item"><span class="key">${key.toUpperCase()}</span><span class="value">${value}</span></div>`;
                }
                html += '</div>';
            }

            // WebGL
            if (data.webgl) {
                html += '<div class="section"><h2>WEBGL</h2>';
                for (const [key, value] of Object.entries(data.webgl)) {
                    html += `<div class="item"><span class="key">${key.toUpperCase()}</span><span class="value">${value}</span></div>`;
                }
                html += '</div>';
            }

            // Plugins
            if (data.plugins) {
                html += '<div class="section"><h2>PLUGINS</h2>';
                data.plugins.forEach((p, i) => {
                    html += `<div class="item"><span class="key">PLUGIN ${i+1}</span><span class="value">${p}</span></div>`;
                });
                html += '</div>';
            }

            // Media Devices
            if (data.media) {
                html += '<div class="section"><h2>MEDIA DEVICES</h2>';
                data.media.forEach((d, i) => {
                    html += `<div class="item"><span class="key">${d.kind.toUpperCase()}</span><span class="value">${d.label || 'Unlabeled'}</span></div>`;
                });
                html += '</div>';
            }

            // Permissions
            if (data.perms) {
                html += '<div class="section"><h2>PERMISSIONS</h2>';
                for (const [key, value] of Object.entries(data.perms)) {
                    html += `<div class="item"><span class="key">${key.toUpperCase()}</span><span class="value">${value}</span></div>`;
                }
                html += '</div>';
            }

            // Canvas Fingerprint
            if (data.canvas) {
                html += '<div class="section"><h2>CANVAS FINGERPRINT</h2>';
                html += `<div class="item"><span class="value">${data.canvas.substring(0, 100)}...</span></div>`;
                html += '</div>';
            }

            // Misc
            html += '<div class="section"><h2>MISC</h2>';
            if (data.ref) html += `<div class="item"><span class="key">REFERRER</span><span class="value">${data.ref || 'DIRECT'}</span></div>`;
            if (data.ts) html += `<div class="item"><span class="key">TIMESTAMP</span><span class="value">${data.ts}</span></div>`;
            html += '</div>';

            document.getElementById('content').innerHTML = html;
        }

        function copyAll() {
            navigator.clipboard.writeText(JSON.stringify(allData, null, 2));
            alert('COPIED TO CLIPBOARD');
        }

        function downloadJSON() {
            const blob = new Blob([JSON.stringify(allData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `data_${Date.now()}.json`;
            a.click();
        }

        function downloadCSV() {
            let csv = 'KEY,VALUE\n';
            const flatten = (obj, prefix = '') => {
                for (const [key, value] of Object.entries(obj)) {
                    if (typeof value === 'object' && value !== null && !Array.isArray(value)) {
                        flatten(value, prefix + key + '.');
                    } else {
                        csv += `"${prefix}${key}","${value}"\n`;
                    }
                }
            };
            flatten(allData);
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `data_${Date.now()}.csv`;
            a.click();
        }

        init();
    </script>
</body>
</html>
